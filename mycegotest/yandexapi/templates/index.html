{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <title>MYCEGO - –¢–ï–°–¢–û–í–û–ï –ó–ê–î–ê–ù–ò–ï</title>
</head>
<body>
    <h1>–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞</h1>
    <form method="GET">
        <label for="public_key">–ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞:</label>
        <input type="text" id="public_key" name="public_key" value="{{ public_key }}" required>
        <label for="file_type">–§–∏–ª—å—Ç—Ä:</label>
        <select id="file_type" name="file_type">
            <option value="all" {% if file_type == "all" %}selected{% endif %}>–í—Å–µ</option>
            <option value="image" {% if file_type == "image" %}selected{% endif %}>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</option>
            <option value="application" {% if file_type == "application" %}selected{% endif %}>–î–æ–∫—É–º–µ–Ω—Ç—ã</option>
            <option value="video" {% if file_type == "video" %}selected{% endif %}>–í–∏–¥–µ–æ</option>
        </select>
        <input type="hidden" name="path" value="{{ path }}">
        <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
    </form>

    {% if path and parent_path %}
        <a href="?public_key={{ public_key }}&path={{ parent_path }}&file_type=all">–ù–∞–∑–∞–¥</a>
    {% endif %}

    {% if files %}
        <h2>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:</h2>
        <form method="POST" action="{% url 'download_selected_files' %}">
            {% csrf_token %}
            <input type="hidden" name="public_key" value="{{ public_key }}">
            <ul>
                {% for file in files %}
                    {% if file.type == "dir" %}
                        <li>
                            üìÇ <a href="?public_key={{ public_key }}&path={{ file.path }}&file_type=all">{{ file.name }}</a>
                        </li>
                    {% elif file.type == "file" %}
                        <li>
                            <input type="checkbox" name="file_paths" value="{{ file.path }}" class="file-checkbox">
                            {{ file.name }} - {{ file.size|default:"N/A" }} –±–∞–π—Ç
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
            <button type="submit" id="download-button" disabled>–°–∫–∞—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
        </form>
    {% elif error %}
        <p style="color: blue; text-align: center">{{ error }}</p>
    {% endif %}

    <script>
        // –í–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
        function toggleDownloadButton() {
            const checkboxes = document.querySelectorAll('.file-checkbox');
            const downloadButton = document.getElementById('download-button');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
            const isAnyChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);

            // –í–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            downloadButton.disabled = !isAnyChecked;
        }

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–±–æ—Ä–∞
        document.querySelectorAll('.file-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', toggleDownloadButton);
        });

        // –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        toggleDownloadButton();
    </script>
</body>
</html>
